<!doctype html>
<html lang="en">

<head>
        <title>ESP32 Lire DHT11 Python - Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="../assets/css/darcula-highlight.min.css">

        <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../assets/css/dracula-ui.min.css">
        <link rel="stylesheet" href="../assets/css/mkdocs.min.css">

        
            <link  rel="icon" type="image/x-icon" href="../assets/img/favicon.ico">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href=".."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Home
                </a>
            </li>
            <li class="drac-box">
                <a href="../tinkerCAD/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    TinkerCAD
                </a>
            </li>
            <li class="drac-box">
                <a href="../proxmox/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Proxmox
                </a>
            </li>
            <li class="drac-box">
                <a href="../linux/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Linux
                </a>
            </li>
            <li class="drac-box">
                <a href="../euro/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Section Euro
                </a>
            </li>
            <li class="drac-box">
                <a href="../adresseip/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Adresse IP
                </a>
            </li>
            <li class="drac-box">
                <a href="../infranetwork/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Infrastructure Réseau
                </a>
            </li>
            <li class="drac-box">
                <a href="../esp/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Carte ESP32/ESP8622
                </a>
            </li>
            <li class="drac-box">
                <a href="../arduino/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Carte Arduino
                </a>
            </li>
            <li class="drac-box">
                <a href="../ide-arduino/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    IDE Arduino
                </a>
            </li>
            <li class="drac-box">
                <a href="../micropython/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    IDE MicroPython
                </a>
            </li>
            <li class="drac-box">
                <a href="../micropython-webserver/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    ESP32 GPIO Python Webserver
                </a>
            </li>
            <li class="drac-box">
                <a href="./"
                    class=" active 
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    ESP32 Lire DHT11 Python
                </a>
            </li>
            <li class="drac-box">
                <a href="../read_temp_dht11_c/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    ESP32 Lire DHT11 C++
                </a>
            </li>
            <li class="drac-box">
                <a href="../esp_mqtt_nodered/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    ESP, MQTT, Node-RED
                </a>
            </li>
            <li class="drac-box">
                <a href="../raspberrypi/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Raspberry Pi
                </a>
            </li>
            <li class="drac-box">
                <a href="../ipphone/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Téléphonie IP
                </a>
            </li>
            <li class="drac-box">
                <a href="../reseau/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Réseau
                </a>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple">
        <div class="container-fluid">
            
            <button class="navbar-toggler w-100 text-center" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav text-md-center">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../micropython-webserver/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a href="../read_temp_dht11_c/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item">
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
                <section class="p-md-5 section-content">
    <article>
        <p><div><h1 id="utilisation-de-micropython-esp32-et-un-capteur-dht11">Utilisation de MicroPython, ESP32 et un capteur DHT11</h1>
<p><img src="/img/capteur-de-temperature-dht11.jpg" alt="image" width="50%" height="auto"></p>
<p>Prérequis :  </p>
<ul>
<li>firmware ESP32 flashé avec le firmware MicroPython   </li>
</ul>
<h2 id="lecture-simple-du-capteur">Lecture simple du capteur</h2>
<p><em>source : https://randomnerdtutorials.com/esp32-esp8266-dht11-dht22-micropython-temperature-humidity-sensor/</em>  </p>
<p>Le capteur DHT11 est très populaire parmi les makers et les adeptes du DIY. Il est, en effet, si prisé qu’il est inclus par défaut dans MicroPython. Son prix avantageux et sa simplicité d’utilisation en sont les principales raisons.</p>
<h3 id="correspondance-des-broches">Correspondance des broches :</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">Module DHT11</th>
<th style="text-align: center;">ESP32</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1 - GND</td>
<td style="text-align: center;">GND</td>
</tr>
<tr>
<td style="text-align: center;">2 - DATA</td>
<td style="text-align: center;">GPIO 17</td>
</tr>
<tr>
<td style="text-align: center;">3 - Vcc</td>
<td style="text-align: center;">3,3V</td>
</tr>
</tbody>
</table>
<p><em>Attention : Selon votre ESP32, la GPIO 17 n'est pas placée au même endroit.
ESP32.</em><br>
<em>Attention : Si le module ne comporte pas de résistance de pullup, il faut en ajouter une entre 4.7kΩ (ou 10kΩ) entre les broches 3V3 et le signal (GPIO17 ).</em></p>
<h3 id="mesurer-la-temperature-et-lhumidite-ambiante-du-dht11-avec-micropython">Mesurer la température et l’humidité ambiante du DHT11 avec MicroPython</h3>
<p>Puisque le DHT11 utilise un protocole propriétaire, il est nécessaire d’utiliser une bibliothèque pour communiquer facilement avec le capteur. Heureusement, elle est incluse par défaut dans MicroPython, donc il n’y a pas besoin de télécharger une bibliothèque externe supplémentaire.  </p>
<p>Le code à utiliser est très simple : il suffit d’instancier un objet dht avec un numéro de pin et d’utiliser la fonction capteur.measure() .<br>
On peut voir d'après le code la sortie GPIO est bien 17.<br>
Le résultat est affiché dans le terminal de l’IDE Thonny. La température est exprimée en degrés Celsius, tandis que l’humidité est exprimée en pourcentage.  </p>
<pre><code>from machine import Pin
from time import sleep
import dht 

sensor = dht.DHT11(Pin(17))

while True:
    sleep(2)
    sensor.measure()
    temp = sensor.temperature()
    hum = sensor.humidity()
    print('Temperature: %3.1f C' %temp)
    print('Humidity: %3.1f %%' %hum)

</code></pre>
<h2 id="lecture-du-capteur-et-envoie-sur-une-page-web">Lecture du capteur et envoie sur une page web</h2>
<p><em>source : https://randomnerdtutorials.com/esp32-esp8266-micropython-web-server/   https://randomnerdtutorials.com/micropython-esp32-esp8266-dht11-dht22-web-server/</em></p>
<p>Par défaut, lorsque vous flasher le firmware MicroPython, un fichier boot.py est créé.</p>
<p>Pour ce projet, vous aurez besoin d'un fichier boot.py et d'un fichier main.py.<br>
- Le fichier boot.py contient le code qui ne doit être exécuté qu'une seule fois au démarrage. Il s'agit de l'importation des bibliothèques, des identifiants réseau, de l'instanciation des broches, de la connexion au réseau et d'autres configurations.</p>
<ul>
<li>Le fichier main.py contient le code qui exécute le serveur web pour servir des fichiers et effectuer des tâches en fonction des demandes reçues par le client.</li>
</ul>
<h3 id="creation-du-fichier-bootpy">Création du fichier <em>boot.py</em></h3>
<p>Dans ce code :
- Crée un client wifi (STA = Station) (on pourrait faire la même chose en AP = Access Point)<br>
- Se connecte au wifi donné<br>
- Renvoie dans le terminal/console les informations du réseau données par le serveur DHCP (IP, Masque, Passerelle, DNS)
- Configure les GPIO
    - GPIO 17 : pour le capteur DHT11</p>
<p><em>boot.py</em></p>
<pre><code>try:
    import usocket as socket
except:
    import socket

import network
from machine import Pin
import dht

import esp
esp.osdebug(None)

import gc
gc.collect()

ssid = 'REPLACE_WITH_YOUR_SSID'
password = 'REPLACE_WITH_YOUR_PASSWORD'

station = network.WLAN(network.STA_IF)

station.active(True)
station.connect(ssid, password)

while station.isconnected() == False:
    pass

print('Connection successful')
print(station.ifconfig())

sensor = dht.DHT11(Pin(17))
</code></pre>
<p>Retour dans la console  </p>
<pre><code>Connection successful
('192.168.1.59', '255.255.255.0', '192.168.1.1', '192.168.1.1')
</code></pre>
<h3 id="creation-du-fichier-mainpy">Création du fichier <em>main.py</em></h3>
<p>Dans ce code :
- Défini une fonction pour lire le capteur<br>
- Défini une fonction pour créer la page html<br>
- Gére les connections au serveur web</p>
<p><em>main.py</em></p>
<pre><code>def read_sensor():
    global temp, hum
    temp = hum = 0.0
    try:
        sensor.measure()
        temp = f'{sensor.temperature():3.2f}'
        hum = f'{sensor.humidity():3.1f}'
        return 0
    except OSError as e:
        return('Failed to read sensor.')


def web_page():
    html = """&lt;!DOCTYPE HTML&gt;&lt;html&gt;
&lt;head&gt;

&lt;/head&gt;
&lt;body&gt;
  &lt;h2&gt;ESP DHT Server&lt;/h2&gt;
  &lt;p&gt;Temp: &lt;strong&gt;""" + str(temp) + """ &amp;deg;C&lt;/strong&gt;&lt;/p&gt;
  &lt;p&gt;Hum: &lt;strong&gt;""" + str(hum) + """ %&lt;/strong&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;"""
    return html

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(('', 80))
s.listen(5)

while True:
    conn, addr = s.accept()
    print('Got a connection from %s' % str(addr))
    request = conn.recv(1024)
    print('Content = %s' % str(request))
    mes = read_sensor()
    response = web_page()
    conn.send('HTTP/1.1 200 OK\n')
    conn.send('Content-Type: text/html\n')
    conn.send('Connection: close\n\n')
    conn.sendall(response)
    conn.close()


</code></pre></div></p>
    </article>
</section>
            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '..';</script>
        <script src="../assets/js/jquery-3.3.1.slim.min.js"></script>
        <script src="../assets/js/bootstrap.bundle.min.js"></script>
        <script src="../assets/js/mkdocs.js"></script>

</body>

</html>