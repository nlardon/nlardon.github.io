<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>ESP32 Lire DHT11 Python - Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "ESP32 Lire DHT11 Python";
        var mkdocs_page_input_path = "read_temp_dht11_python.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../proxmox/">Proxmox</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../linux/">Linux</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../euro/">Section Euro</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../adresseip/">Adresse IP</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../infranetwork/">Infrastructure Réseau</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../esp/">Carte ESP32/ESP8622</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../arduino/">Carte Arduino</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ide-arduino/">IDE Arduino</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../micropython/">IDE MicroPython</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../micropython-webserver/">ESP32 GPIO Python Webserver</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">ESP32 Lire DHT11 Python</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#lecture-simple-du-capteur">Lecture simple du capteur</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#correspondance-des-broches">Correspondance des broches :</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mesurer-la-temperature-et-lhumidite-ambiante-du-dht11-avec-micropython">Mesurer la température et l’humidité ambiante du DHT11 avec MicroPython</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#lecture-du-capteur-et-envoie-sur-une-page-web">Lecture du capteur et envoie sur une page web</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#creation-du-fichier-bootpy">Création du fichier boot.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#creation-du-fichier-mainpy">Création du fichier main.py</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../read_temp_dht11_c/">ESP32 Lire DHT11 C++</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">ESP32 Lire DHT11 Python</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="utilisation-de-micropython-esp32-et-un-capteur-dht11">Utilisation de MicroPython, ESP32 et un capteur DHT11</h1>
<p><img src="/img/capteur-de-temperature-dht11.jpg" alt="image" width="50%" height="auto"></p>
<p>Prérequis :  </p>
<ul>
<li>firmware ESP32 flashé avec le firmware MicroPython   </li>
</ul>
<h2 id="lecture-simple-du-capteur">Lecture simple du capteur</h2>
<p><em>source : https://randomnerdtutorials.com/esp32-esp8266-dht11-dht22-micropython-temperature-humidity-sensor/</em>  </p>
<p>Le capteur DHT11 est très populaire parmi les makers et les adeptes du DIY. Il est, en effet, si prisé qu’il est inclus par défaut dans MicroPython. Son prix avantageux et sa simplicité d’utilisation en sont les principales raisons.</p>
<h3 id="correspondance-des-broches">Correspondance des broches :</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">Module DHT11</th>
<th style="text-align: center;">ESP32</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1 - GND</td>
<td style="text-align: center;">GND</td>
</tr>
<tr>
<td style="text-align: center;">2 - DATA</td>
<td style="text-align: center;">GPIO 17</td>
</tr>
<tr>
<td style="text-align: center;">3 - Vcc</td>
<td style="text-align: center;">3,3V</td>
</tr>
</tbody>
</table>
<p><em>Attention : Selon votre ESP32, la GPIO 17 n'est pas placée au même endroit.
ESP32.</em><br />
<em>Attention : Si le module ne comporte pas de résistance de pullup, il faut en ajouter une entre 4.7kΩ (ou 10kΩ) entre les broches 3V3 et le signal (GPIO17 ).</em></p>
<h3 id="mesurer-la-temperature-et-lhumidite-ambiante-du-dht11-avec-micropython">Mesurer la température et l’humidité ambiante du DHT11 avec MicroPython</h3>
<p>Puisque le DHT11 utilise un protocole propriétaire, il est nécessaire d’utiliser une bibliothèque pour communiquer facilement avec le capteur. Heureusement, elle est incluse par défaut dans MicroPython, donc il n’y a pas besoin de télécharger une bibliothèque externe supplémentaire.  </p>
<p>Le code à utiliser est très simple : il suffit d’instancier un objet dht avec un numéro de pin et d’utiliser la fonction capteur.measure() .<br />
On peut voir d'après le code la sortie GPIO est bien 17.<br />
Le résultat est affiché dans le terminal de l’IDE Thonny. La température est exprimée en degrés Celsius, tandis que l’humidité est exprimée en pourcentage.  </p>
<pre><code>from machine import Pin
from time import sleep
import dht 

sensor = dht.DHT11(Pin(17))

while True:
    sleep(2)
    sensor.measure()
    temp = sensor.temperature()
    hum = sensor.humidity()
    print('Temperature: %3.1f C' %temp)
    print('Humidity: %3.1f %%' %hum)

</code></pre>
<h2 id="lecture-du-capteur-et-envoie-sur-une-page-web">Lecture du capteur et envoie sur une page web</h2>
<p><em>source : https://randomnerdtutorials.com/esp32-esp8266-micropython-web-server/   https://randomnerdtutorials.com/micropython-esp32-esp8266-dht11-dht22-web-server/</em></p>
<p>Par défaut, lorsque vous flasher le firmware MicroPython, un fichier boot.py est créé.</p>
<p>Pour ce projet, vous aurez besoin d'un fichier boot.py et d'un fichier main.py.<br />
- Le fichier boot.py contient le code qui ne doit être exécuté qu'une seule fois au démarrage. Il s'agit de l'importation des bibliothèques, des identifiants réseau, de l'instanciation des broches, de la connexion au réseau et d'autres configurations.</p>
<ul>
<li>Le fichier main.py contient le code qui exécute le serveur web pour servir des fichiers et effectuer des tâches en fonction des demandes reçues par le client.</li>
</ul>
<h3 id="creation-du-fichier-bootpy">Création du fichier <em>boot.py</em></h3>
<p>Dans ce code :
- Crée un client wifi (STA = Station) (on pourrait faire la même chose en AP = Access Point)<br />
- Se connecte au wifi donné<br />
- Renvoie dans le terminal/console les informations du réseau données par le serveur DHCP (IP, Masque, Passerelle, DNS)
- Configure les GPIO
    - GPIO 17 : pour le capteur DHT11</p>
<p><em>boot.py</em></p>
<pre><code>try:
    import usocket as socket
except:
    import socket

import network
from machine import Pin
import dht

import esp
esp.osdebug(None)

import gc
gc.collect()

ssid = 'REPLACE_WITH_YOUR_SSID'
password = 'REPLACE_WITH_YOUR_PASSWORD'

station = network.WLAN(network.STA_IF)

station.active(True)
station.connect(ssid, password)

while station.isconnected() == False:
    pass

print('Connection successful')
print(station.ifconfig())

sensor = dht.DHT11(Pin(17))
</code></pre>
<p>Retour dans la console  </p>
<pre><code>Connection successful
('192.168.1.59', '255.255.255.0', '192.168.1.1', '192.168.1.1')
</code></pre>
<h3 id="creation-du-fichier-mainpy">Création du fichier <em>main.py</em></h3>
<p>Dans ce code :
- Défini une fonction pour lire le capteur<br />
- Défini une fonction pour créer la page html<br />
- Gére les connections au serveur web</p>
<p><em>main.py</em></p>
<pre><code>def read_sensor():
    global temp, hum
    temp = hum = 0.0
    try:
        sensor.measure()
        temp = f'{sensor.temperature():3.2f}'
        hum = f'{sensor.humidity():3.1f}'
        return 0
    except OSError as e:
        return('Failed to read sensor.')


def web_page():
    html = &quot;&quot;&quot;&lt;!DOCTYPE HTML&gt;&lt;html&gt;
&lt;head&gt;

&lt;/head&gt;
&lt;body&gt;
  &lt;h2&gt;ESP DHT Server&lt;/h2&gt;
  &lt;p&gt;Temp: &lt;strong&gt;&quot;&quot;&quot; + str(temp) + &quot;&quot;&quot; &amp;deg;C&lt;/strong&gt;&lt;/p&gt;
  &lt;p&gt;Hum: &lt;strong&gt;&quot;&quot;&quot; + str(hum) + &quot;&quot;&quot; %&lt;/strong&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;&quot;&quot;
    return html

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(('', 80))
s.listen(5)

while True:
    conn, addr = s.accept()
    print('Got a connection from %s' % str(addr))
    request = conn.recv(1024)
    print('Content = %s' % str(request))
    mes = read_sensor()
    response = web_page()
    conn.send('HTTP/1.1 200 OK\n')
    conn.send('Content-Type: text/html\n')
    conn.send('Connection: close\n\n')
    conn.sendall(response)
    conn.close()


</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../micropython-webserver/" class="btn btn-neutral float-left" title="ESP32 GPIO Python Webserver"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../read_temp_dht11_c/" class="btn btn-neutral float-right" title="ESP32 Lire DHT11 C++">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../micropython-webserver/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../read_temp_dht11_c/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
