<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>ESP32 GPIO Python Webserver - Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "ESP32 GPIO Python Webserver";
        var mkdocs_page_input_path = "micropython-webserver.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../proxmox/">Proxmox</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../linux/">Linux</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../euro/">Section Euro</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../adresseip/">Adresse IP</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../infranetwork/">Infrastructure Réseau</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../esp/">Carte ESP32/ESP8622</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../arduino/">Carte Arduino</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ide-arduino/">IDE Arduino</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../micropython/">IDE MicroPython</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">ESP32 GPIO Python Webserver</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#controler-unse-sortie">Contrôler unse sortie</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#creation-du-fichier-bootpy">Création du fichier boot.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#creation-du-fichier-mainpy">Création du fichier main.py</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../read_temp_dht11_python/">ESP32 Lire DHT11 Python</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../read_temp_dht11_c/">ESP32 Lire DHT11 C++</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../raspberrypi/">Raspberry Pi</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ipphone/">Téléphonie IP</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Cybersécurité, Informatique et Réseaux, Électronique - Thomas Edison</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">ESP32 GPIO Python Webserver</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="utilisation-de-micropython-et-webserver">Utilisation de MicroPython et Webserver</h1>
<p>Prérequis :  </p>
<ul>
<li>firmware ESP32 flashé avec le firmware MicroPython   </li>
</ul>
<h2 id="controler-unse-sortie">Contrôler unse sortie</h2>
<p><em>source : https://randomnerdtutorials.com/esp32-esp8266-micropython-web-server/</em>  </p>
<p>Par défaut, lorsque vous flasher le firmware MicroPython, un fichier boot.py est créé.</p>
<p>Pour ce projet, vous aurez besoin d'un fichier boot.py et d'un fichier main.py.<br />
- Le fichier boot.py contient le code qui ne doit être exécuté qu'une seule fois au démarrage. Il s'agit de l'importation des bibliothèques, des identifiants réseau, de l'instanciation des broches, de la connexion au réseau et d'autres configurations.</p>
<ul>
<li>Le fichier main.py contient le code qui exécute le serveur web pour servir des fichiers et effectuer des tâches en fonction des demandes reçues par le client.</li>
</ul>
<h3 id="creation-du-fichier-bootpy">Création du fichier <em>boot.py</em></h3>
<p>Dans ce code :
- Crée un client wifi (STA = Station) (on pourrait faire la même chose en AP = Access Point)<br />
- Se connecte au wifi donné<br />
- Renvoie dans le terminal/console les informations du réseau données par le serveur DHCP (IP, Masque, Passerelle, DNS)
- Configure les GPIO</p>
<p><em>boot.py</em></p>
<pre><code>try:
  import usocket as socket
except:
  import socket

from machine import Pin
import network

import esp
esp.osdebug(None)

import gc
gc.collect()

ssid = 'REPLACE_WITH_YOUR_SSID'
password = 'REPLACE_WITH_YOUR_PASSWORD'

station = network.WLAN(network.STA_IF)

station.active(True)
station.connect(ssid, password)

while station.isconnected() == False:
  pass

print('Connection successful')
print(station.ifconfig())

led = Pin(2, Pin.OUT)
</code></pre>
<p>Retour dans la console  </p>
<pre><code>Connection successful
('192.168.1.59', '255.255.255.0', '192.168.1.1', '192.168.1.1')
</code></pre>
<h3 id="creation-du-fichier-mainpy">Création du fichier <em>main.py</em></h3>
<p>Dans ce code :
- Défini une fonction pour lire le statue des gpio et crée la page html<br />
- Gére les connections au serveur web</p>
<p><em>main.py</em></p>
<pre><code>def web_page():
    if led.value() == 1:
        gpio_state=&quot;ON&quot;
    else:
        gpio_state=&quot;OFF&quot;

    html =&quot;&quot;&quot;&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;ESP Web Server&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;ESP Web Server&lt;/h1&gt; 
        &lt;p&gt;GPIO state: &lt;strong&gt;&quot;&quot;&quot; + gpio_state + &quot;&quot;&quot;&lt;/strong&gt;&lt;/p&gt;
        &lt;p&gt;&lt;a href=&quot;/?led=on&quot;&gt;&lt;button class=&quot;button1&quot;&gt;ON&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;
        &lt;p&gt;&lt;a href=&quot;/?led=off&quot;&gt;&lt;button class=&quot;button2&quot;&gt;OFF&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;/body&gt;
    &lt;/html&gt;&quot;&quot;&quot;
    return html

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(('', 80))
s.listen(5)

while True:
    conn, addr = s.accept()
    print('Got a connection from %s' % str(addr))
    request = conn.recv(1024)
    request = str(request)
    print('Content = %s' % request)
    led_on = request.find('/?led=on')
    led_off = request.find('/?led=off')
    if led_on == 6:
        print('LED ON')
        led.value(1)
    if led_off == 6:
        print('LED OFF')
        led.value(0)
    response = web_page()
    conn.send('HTTP/1.1 200 OK\n')
    conn.send('Content-Type: text/html\n')
    conn.send('Connection: close\n\n')
    conn.sendall(response)
    conn.close()
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../micropython/" class="btn btn-neutral float-left" title="IDE MicroPython"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../read_temp_dht11_python/" class="btn btn-neutral float-right" title="ESP32 Lire DHT11 Python">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../micropython/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../read_temp_dht11_python/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
